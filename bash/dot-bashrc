#!/bin/bash
# .bashrc
# Run when an interactive shell that is not a login shell executes.
# When a login shell executes .bash_profile is read first.
# Source this file in .bash_profile
# See `man bash` /INVOCATIONS

export HOSTNAME_CT_LT="ct-lt-02087"
HOSTNAME_MBP="tomp-mbp.mynet"

is_macos()
{
	test "$(uname -s)" = "Darwin"
}

# include if file exists
include()
{
	if [ -f "$1" ]; then
		source "$1"
	fi
}

# append string to PATH, if PATH does not already contain string
pathadd()
{
	declare -r suffix="$1"

	if ! [[ "$PATH" =~ .*"$suffix".* ]]; then
		export PATH="${PATH}:${suffix}"
	fi
}

ps1()
{
	declare color_prompt debian_chroot

	# set variable identifying the chroot you work in
	if [ -z "${debian_chroot:-}" ] && [ -r /etc/debian_chroot ]; then
		debian_chroot=$(cat /etc/debian_chroot)
	fi

	# Custom PS1 for the following machines
	case "$(hostname)" in
	"$HOSTNAME_MBP"|"$HOSTNAME_CT_LT")
		PS1='${debian_chroot:+($debian_chroot)}\w\[\033[33m\]\$\[\033[0m\] '
		return
		;;
	esac

	# Default PS1 (ripped from Debian .bashrc)
	case "$TERM" in
	xterm-color|*-256color)
		color_prompt=yes
		;;
	esac
	if [ "$color_prompt" = yes ]; then
		PS1='${debian_chroot:+($debian_chroot)}\[\033[01;32m\]\u@\h\[\033[00m\]:\[\033[01;34m\]\w\[\033[00m\]\$ '
	else
		PS1='${debian_chroot:+($debian_chroot)}\u@\h:\w\$ '
	fi
}

include "/etc/bashrc"
include "$HOME/.bash_aliases"
include "$HOME/journal/journal.env"

if is_macos; then
	include "/usr/local/etc/bash_completion"
	alias ls="ls -G"
else
	alias ls="ls --color=auto"
fi

# bitwarden session
alias bws="bash --rcfile ~/.bws.bashrc"

alias grep="grep --color=auto"
alias l="ls -CF"
alias la="ls -A"
alias ll="ls -l"
alias vim="nvim"

pathadd "$HOME/.local/bin"
pathadd "$HOME/.cargo/bin"

ps1

export EDITOR="nvim"
# Don't use stow-symlinks with weechat config, just point right at it. This is
# because Docker can't see outside of the volume, so the symlinks break.
export WEECHAT_HOME="$HOME/.dotfiles/weechat"
export SUP_LOG_DIR="$WEECHAT_HOME/logs"
export SUP_DIR="$HOME/w/standup"
export JDIR="$HOME/Documents/journal"
export JDIR_ENTRIES="$JDIR/entries"

# Uncomment the following line if you don't like systemctl's auto-paging feature:
# export SYSTEMD_PAGER=
